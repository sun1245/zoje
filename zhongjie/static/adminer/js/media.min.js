define(["jquery","adminer/js/ui","template","tools","jquery.ui.widget","jquery.iframe-transport","jquery.fileupload-process","jquery.fileupload","jquery.number","jquery.xdr-transport"],function(t,a,e,o){var i={};return i.del=function(a){a&&t.ajax({type:"POST",url:UPLOADDO_URL+"delete",data:{ids:a,_cfs:t.cookie("_cfc"),_method:"DELETE"},dataType:"json"}).done(function(e){var o="error";if(e.status+0===0)console.log("delete error!");else{o="notie",_t=t('.js-goal[data-id="'+a+'"]');var n=_t.parents(".js-img-list-f").attr("id").replace("js-","").replace("-show","");_t.remove(),i.ui_del(a,n),"undefined"!=typeof i.del_done&&i.del_done instanceof Function&&i.del_done(a,n)}t.pnotify({title:"删除文件",text:e.msg,type:o,animation:"fade"})}).fail(function(a,e,o){var i=a.responseJSON;t.pnotify({title:"错误提示！",text:i.msg,type:"error",animation:"fade"})})},i.ui_del=function(a,e){if(t("input[name="+e+"]").attr("data-more")-0===0)a==t("input[name="+e+"]").val()&&(t("input[name="+e+"]").val(""),t("input[name="+e+"]").next("input[name=thumb]").val(""));else{var o="";t("#js-"+e+"-show div[data-id]").each(function(a,i){0===a?(t("input[name="+e+"]").next("input[name=thumb]").val(t(i).attr("data-thumb")),o=t(i).attr("data-id")):t(i).attr("data-id")&&(o+=","+t(i).attr("data-id"))}),t("input[name="+e+"]").val(o)}},i.done=function(a,o){if(t("input[name="+o+"]").attr("data-more")-0===0){a.it=a.list[0];var n=e.render("tpl-photo-show",a);t("#js-"+o+"-show").html(n);var l=t("input[name="+o+"]").val();l&&i.del(l),t("input[name="+o+"]").val(a.list[0].id),t("input[name="+o+"]").next().val(a.list[0].thumb)}else{var d=e.render("tpl-photos-show",a);t("#js-"+o+"-show").append(d);var r="";t("#js-"+o+"-show div[data-id]").each(function(a,e){0===a?(t("input[name="+o+"]").next("input[name=thumb]").val(t(e).attr("data-thumb")),r=t(e).attr("data-id")):t(e).attr("data-id")&&(r+=","+t(e).attr("data-id"))}),t("input[name="+o+"]").val(r)}},i.show=function(a,i){if(a&&"undefined"!=typeof a&&!o.isEmpty(a)){var n,l;a instanceof Array?(n={upload_url:UPLOAD_URL,static_url:STATIC_URL,list:a},l=e.render("tpl-photos-show",n)):(n={upload_url:UPLOAD_URL,static_url:STATIC_URL,it:a},l=e.render("tpl-photo-show",n)),t("#js-"+i+"-show").html(l)}},i.get_day_list=function(o,i){t.ajax({type:"GET",url:UPLOADDO_URL+"get_day_ajax",data:{dt:o,nocache:Math.random()},dataType:"json"}).done(function(a,o){var n;a.status+0===0?t.pnotify({title:"没有数据",text:a.msg,type:status,animation:"fade"}):(a.upload_url=UPLOAD_URL,a.static_url=STATIC_URL,a.uploado_url=UPLOADDO_URL,tdata=a.list,console.log(tdata),tdata instanceof Array?(a={upload_url:UPLOAD_URL,static_url:STATIC_URL,list:tdata},n=e.render("tpl-photos-show",a)):(a={upload_url:UPLOAD_URL,static_url:STATIC_URL,it:tdata},n=e.render("tpl-photo-show",a))),t("#"+i).html(n)}).fail(function(e,o,n){var l=e.responseJSON;t.pnotify({title:"错误提示！",text:l.msg,type:"error",animation:"fade"}),t("#"+i).after(a.alert("访问数据列表错误 ：<br />"+l))})},i.sort=function(a){t("#js-"+a+"-show").sortable({update:function(e,o){var i="";t("#js-"+a+"-show div[data-id]").each(function(e,o){0===e?(t("input[name="+a+"]").next("input[name=thumb]").val(t(o).attr("data-thumb")),i=t(o).attr("data-id")):t(o).attr("data-id")&&(i+=","+t(o).attr("data-id"))}),t("input[name="+a+"]").val(i)}}).disableSelection()},i.set_seo=function(t,a,e){},i.init=function(o,n){t('input[type="file"].fileupload').each(function(a,l){var d=UPLOADDO_URL;void 0!==t(l).attr("data-size")&&(d+="?size="+t(l).attr("data-size")),t(l).fileupload({url:d,dataType:"json",formData:{_cfs:t.cookie("_cfc")},fail:function(a,e,o){var i=a.responseJSON;t.pnotify({title:"错误",text:i+"上传错误，请联系管理员！",type:"error",animation:"fade"})},done:function(a,l){var d=l.result.files,r="FID:";if(t.each(l.result.files,function(a,e){d[a].size=t.number(e.size/1024,2),r+="->"+e.id}),void 0===d[0].error){t.pnotify({title:"上传文件",text:"已经上传文件。"+r,type:"success",animation:"fade"}),t("#upload-modal").delay(1e3).hide(500);var s={upload_url:UPLOAD_URL,static_url:STATIC_URL,list:d},u=e.render("tpl-upload-list",s);t("#js-upload-list-f").prepend(u);var p="";p=void 0===t(this).attr("data-for")?t(this).parent().next("input[type=hidden]").attr("name"):t(this).attr("data-for"),i.del_done=n,i.done(s,p),"undefined"!=typeof o&&o instanceof Function&&o(s,p)}else t.pnotify({title:"上传失败",text:"您的文件不被允许上传，请询问管理员！<br/>"+d[0].error,type:"error",animation:"fade"})},progressall:function(a,e){t("#upload-modal").show(300);var o=parseInt(e.loaded/e.total*100,10);t("#upload-modal .progress .progress-bar").css("width",o+"%")}}).prop("disabled",!t.support.fileInput).parent().addClass(t.support.fileInput?void 0:"disabled")}),t("#upload-modal > .upload-header > a.upload-close").on("click",function(a){a.preventDefault(),t("#upload-modal").hide(),t("#js-upload-list-f").html("")}),t("#upload-modal").delegate("li a[data-del]","click",function(a){a.preventDefault(),i.del(t(this).attr("data-del"))}),t(".js-img-list-f").delegate(".js-goal a[data-del]","click",function(a){a.preventDefault(),t(this).attr("data-del")?i.del(t(this).attr("data-del")):t(this).parents(".js-goal").remove()}),t(".js-img-list-f").delegate(".js-goal a[data-seo]","click",function(e){e.preventDefault();var o=t(this).attr("data-seo");t.ajax({url:UPLOADDO_URL+"get_ajax/"+o,type:"GET",dataType:"JSON"}).done(function(a){console.log("success"),console.log(a),t("#js-upload-seo-title").val(a.title),t("#js-upload-seo-alt").val(a.alt),t("#js-upload-seo-text").val(a.text),t("#js-upload-seo-name").text(a.name),t("#js-upload-seo-save").attr("data-fid",a.id),t("#js-upload-seo-modal").modal()}).fail(function(e,o,i){var n=e.responseJSON;t.pnotify({title:"错误提示！",text:n.msg,type:"error",animation:"fade"}),t("#"+domf).after(a.alert("访问数据错误 ：<br />"+n))}).always(function(){console.log("complete")})}),t("#js-upload-seo-save").on("click",function(e){e.preventDefault();var o=t(this).attr("data-fid"),i={fid:o,alt:t("#js-upload-seo-alt").val(),title:t("#js-upload-seo-title").val(),text:t("#js-upload-seo-text").val(),_cfs:t.cookie("_cfc")};t.ajax({url:UPLOADDO_URL+"seo_ajax",type:"POST",dataType:"JSON",data:i}).done(function(a){console.log("success");var e={title:"",text:a.msg,type:"",delay:3e3};1==a.status?(e.title="成功!",e.type="success"):(e.title="错误！",e.type="error"),t.pnotify(e)}).fail(function(e,o,i){var n=e.responseJSON;t.pnotify({title:"错误提示！",text:n.msg,type:"error",animation:"fade"}),t("#"+domf).after(a.alert("访问数据错误 ：<br />"+n))}).always(function(){console.log("complete")})}),a.fancybox_img(),require(["adminer/js/crop"],function(t){t()})},i});